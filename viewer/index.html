<!DOCTYPE html>
<html>

<head>
    <Title>DEM view v0.106</Title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	
<link href="style.css" rel="stylesheet" type="text/css"  >


<script type='text/javascript' src='js/jquery-1.7.2.min.js'  ></script>
<script type="text/javascript" src="js/jquery.simplemodal.1.4.2.min.js"></script>
<script type='text/javascript' src='js/jquery.base64.min.js' ></script>

<script type="text/javascript" src="minicolors/jquery.miniColors.js"></script>
<link type="text/css" rel="stylesheet" href="minicolors/jquery.miniColors.css" />


<link type='text/css' href='style/basic.css' rel='stylesheet' media='screen' />

<script type='text/javascript' src='Three.js' ></script>
<script type='text/javascript' src='FirstPersonNavigationControls.js' ></script>

<script src='sun.js' type='text/javascript' ></script>

<script src='3dview.js' type='text/javascript' ></script>
<script src='2dview.js' type='text/javascript' ></script>

<script src='mapcolor.js' type='text/javascript' ></script>
<script src='mapcolorgui.js' type='text/javascript' ></script>

<script src='libs/bzip2.js' type='text/javascript' ></script>

<script src='libs/raster.js' type='text/javascript' ></script>

<script type='text/javascript' >

//plg changes 8/25/2013
//    moved code to load DEM out of document.ready, so it can be called with buttons
//    put DEM loading buttons on bottom of screen (they need to be made smaller)
//    added HTML title with version (which at this point just insures that I remember to save edits)
//two new color modes
//shortened many of the prompts, so they take up less screen space on a handheld
//got the coordinates to display as you roam
//interface very much in transition--need to hide palette manipulation, and make sun angle more readily visible
//need to enable finger motions for handheld

	
	var mapcolor;  
	var mapcolorgui; 
	var img; 
	var DispMode=1;
	var fName; 
		
	function renderMode(mode){
		if(mapcolor.mode_2d){
		   $('#mode').html('Switch to 3D Mode');
		}else{
		   $('#mode').html('Switch to 2D Mode');
		   $("#location_x").html('');
		   $("#location_y").html('');
		}
	}; 
	
	function isCanvasSupported(){
		var elem = document.createElement('canvas');
		return !(elem.getContext && elem.getContext('2d') && elem.getContext('3d'));
	}; 
	
	function getUrlVars() {
		var vars = {};
		var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
			vars[key] = value;
		});
		return vars;
	}
	
	function error (err) {
		alert(err);
	};
	
	
	function load_raster (raster) {
		mapcolor = new MapColor(raster,DispMode);
			mapcolor.setMode2D(true);
			renderMode();

			$('#mode').click(function(){ 
				 mapcolor.toggleMode();
			}); 

			$('#loading').hide(); 
			$('#content').show(); 
					 
			mapcolorgui = new MapColorGUI(mapcolor, $('#mapcolor_gui'));
			mapcolorgui.render();
	};

	
	function OpenDEM(fName){
	        $('#loading').show(); 
	        downloadFile(fName,
					function (bytes) {
						Raster.load_json_bz2 (bytes, load_raster,	error);
					}
				);
	}			
	
	$(document).ready(
	  function () {
		  $('#content').hide();
          $('#loading').hide(); 		  
		  if(isCanvasSupported()) {
		     fName = 'duck.json.bz2';
             OpenDEM(fName); 
		}
		else{
				$('#not_suported').modal(); 
			}
		}
	);
	
	
</script>

</head>

<body>



<div id='content'  >


<div style="visibility:hidden; width:0px; height:0px;">
	<div>
		<div id='save_pallet_modal'>
			<fieldset >
				<legend>Save Palette</legend>
				Insert name to identify palette: 
				<p>
				<input type='text' id='pallet_name' value='my pallet' >
				<button id='save_pallet' >Save</button> 
				</p>
			</fieldset>
			
			<p style='color: #ff0000;'>
				(X) Close to cancel. 
			</p>
		</div>
	</div>
</div>

<div id='mapcolor_gui'>
    <fieldset>
		<legend>Location</legend>
		<!-- x:<div id='location_x'></div> -->utm_x:<div id='utm_x'></div><br>
		<!-- y:<div id='location_y'></div>-->utm_y:<div id='utm_y'></div><br>
		<!-- z:<div id='location_z'></div>-->elev_z:<div id='elev_z'></div><br>
	</fieldset>	
	<button id='mode'></button>
	<p>Flat Render<input type='checkbox' id='flat' /></p>
	
	<fieldset>
		<legend>Elevation Range</legend>
		<div style='float:left;'>max</div><div style='float:right;' id='e_max'></div><br>
		<div style='float:left;' >min</div><div style='float:right;' id='e_min'></div>
	</fieldset>
	
	<fieldset>
		<legend>Palette</legend>
	<select id='pallets'></select>
	<p>Number of colors: <input id='colors' type='text' value='2' style='width: 50px;'/></p> 
	<div class='container'></div>
	<canvas id='scale_colors'></canvas>
	<div style='clear: both'></div>
	<button id='apply' >Apply</button>
	
	<button id='save'>Save</button>
	<button id='save_as'>Save As</button>
	<button id='delete'>Delete</button>
	</fieldset>
	
	<fieldset>
		<legend>Sun</legend>
		<p>X angle <input type='number' id='x_angle' value='0' ></input></p>
		<p>Y angle <input type='number' id='y_angle' value='0' ></input></p>
		
		<button id='apply_angles'>Apply Angles</button>
		<p>Opacity <input id='sun_alpha' ></input></p>
	</fieldset>
</div>
<div id="viewport"></div>


</div>

<div class='help'>
<form name="vert_exag">
    Display<input type="radio" name="display" id="terrain" onclick='DispMode=1; OpenDEM(fName);' checked="checked"></input>Terrain
	<input type="radio" name="display" id="gold" onclick='DispMode=2; OpenDEM(fName);' ></input>Gold
    <input type="radio" name="display" id="defined" onclick='DispMode=3; OpenDEM(fName);'></input>Defined
</form>  
 	
   <input value="Death Valley" onclick="fName = 'dv_utm.json.bz2'; OpenDEM(fName); " type="button" ></input>
   <input value="Duck" onclick="fName = 'duck.json.bz2'; OpenDEM(fName);"  type="button" ></input>
   <input value="California" onclick="fName = 'ca_utm.json.bz2'; OpenDEM(fName);" type="button" ></input>
     Problems consult <a target='_blank' href='help.html'>help page</a>.
</div>

<div id='loading'  class='info' >
			<p style='color:red'>Loading... Patience, may take a while.</p>
</div>

<div id='not_suported'  style='display: none' >
	<p>Feature not supported by browser; see<a target='_blank' href='../maps/help.html#terrain_viewer'>help</a> page. 
	</p>
</div>



</body>
</html> 




